meta:
  app_name: "company-lifecycle-cl"
  repo_slug: "djb258/company-lifecycle-cl"
  stack:
    - "react"
    - "vite"
    - "typescript"
    - "neon"
    - "tailwindcss"
    - "shadcn-ui"
  llm:
    providers:
      - anthropic
      - openai
    default: "anthropic"

doctrine:
  unique_id: "HUB-CL-001-${TIMESTAMP}-${RANDOM_HEX}"
  process_id: "CL-CORE"
  schema_version: "HEIR/1.0"
  hub_name: "Company Lifecycle Hub"
  hub_id: "HUB-CL-001"
  altitude: "30k"
  ctb_path: "sys/company-lifecycle"
  owner: "Barton / Supreme Headquarters (SHQ)"

  # Sovereign Intake Engine Configuration
  intake_engine:
    version: "2.0.0"
    doctrine: "STATE_AS_DATA"
    description: |
      State-agnostic Sovereign Intake Engine.
      NC is Source Stream #001, not special.
      State is DATA, not CODE.
      All states use the same verification logic.
      Identity minting ONLY after VERIFIED status.

    # LOCKED INVARIANT
    invariant: |
      If any code path mints an identity without passing through
      cl.company_candidate â†’ verifyCandidate(), the build is invalid.

    # Execution Path (SINGLE, CANONICAL)
    execution_path:
      - step: "ingest"
        cli: "pipeline/ingest.js --source <STATE> --file <PATH>"
        writes_to: "cl.company_candidate"
        mints_identity: false
      - step: "verify"
        cli: "pipeline/orchestrator.js --state <STATE>"
        reads_from: "cl.company_candidate"
        mints_identity: true
        guard: "assertVerificationComplete()"

    source_streams:
      NC_EXCEL_SS001:
        id: "SS-001"
        name: "NC Company Data (Excel/Clay)"
        state_code: "NC"
        adapter: "NCExcelSourceAdapter"
        status: "active"
      DE_CSV_SS002:
        id: "SS-002"
        name: "DE Company Data (Clay CSV)"
        state_code: "DE"
        adapter: "DECsvSourceAdapter"
        status: "active"
      # Future streams:
      # TX_CSV_SS003:
      #   id: "SS-003"
      #   name: "TX Company Data"
      #   state_code: "TX"
      #   adapter: "TXCsvSourceAdapter"
      #   status: "planned"

    admission_gate:
      rule: "company_domain IS NOT NULL OR linkedin_url IS NOT NULL"
      fail_action: "reject"

    verification:
      pipeline: "LifecycleWorker.verifyCandidate"
      state_agnostic: true
      guard: "assertVerificationComplete"
      rules:
        - "Admission gate (domain OR LinkedIn)"
        - "Company name required"
        - "Domain format validation"
        - "LinkedIn URL format validation"
        - "Generic email domain rejection"

    identity_minting:
      trigger: "verification_status = 'VERIFIED'"
      guard: "assertVerificationComplete(candidate, verificationResult)"
      dedup_keys:
        - company_domain
        - linkedin_company_url
      sovereign_id: "company_unique_id"

    deprecated:
      path: "deprecated/"
      reason: "Old NC-specific pipeline violated verification-before-minting invariant"
      files:
        - "nc-phases-b-f.js"
        - "nc-phase-a-validation.js"
        - "pass-2-name-canonicalization.js"
        - "pass-3-domain-coherence.js"
        - "pass-4-collision-detection.js"
        - "pass-5-firmographic-coherence.js"

deliverables:
  repos:
    - name: "company-lifecycle-cl"
      visibility: private
      hub_type: "sovereign-authority"
  services:
    - name: "web"
      port: 5173
      description: "Vite development server"
    - name: "preview"
      port: 4173
      description: "Vite preview server"
  env:
    VITE_NEON_URL: "${DOPPLER:NEON_URL}"
    VITE_NEON_API_KEY: "${DOPPLER:NEON_API_KEY}"
    LLM_DEFAULT_PROVIDER: "anthropic"

contracts:
  acceptance:
    - "All HEIR checks pass in CI"
    - "Build succeeds without errors"
    - "Lint passes without errors"
    - "All tests pass"
    - "Hub compliance checklist verified"

build:
  actions:
    lint: ["npm run lint"]
    build: ["npm run build"]
    test: ["npm run test"]
    heir_check: ["npm run heir:check"]
  ci_checks:
    - "npm run lint"
    - "npm run build"
  telemetry_events:
    - "app.start"
    - "lifecycle.stage.promotion"
    - "company.identity.mint"
    - "subhub.activate"
    - "subhub.deactivate"

imo:
  ingress:
    - name: "Outreach App"
      type: "spoke"
      description: "Outreach events (activation, meeting set)"
    - name: "Sales App"
      type: "spoke"
      description: "Sales outcome events"
    - name: "Client App"
      type: "spoke"
      description: "Client activation confirmation"
  middle:
    - name: "Neon (Primary DB)"
      type: "database"
      doctrine_id: "DB-NEON-01"
    - name: "Event Validator"
      type: "validation"
      doctrine_id: "EVT-VALID-01"
  egress:
    - name: "Reporting"
      type: "spoke"
      description: "Read-only lifecycle state"
    - name: "UI Shell"
      type: "spoke"
      description: "Read-only lifecycle view"
    - name: "Audit Log"
      type: "event"
      description: "Immutable lifecycle history"

guard_rails:
  - type: "validation"
    name: "Duplicate Company Creation"
    action: "reject"
  - type: "validation"
    name: "Multiple Active Sub-Hubs"
    action: "reject"
  - type: "validation"
    name: "Invalid Promotion Order"
    action: "reject"
  - type: "validation"
    name: "Unauthorized Promotion"
    action: "reject"

kill_switch:
  endpoint: "/cl/kill-switch"
  activation_criteria: "Invalid lifecycle mutation detected"
  emergency_contact: "SHQ / Barton Ops"
